<!DOCTYPE html>
<html>

<head>
    <title><%= title %> - Watch</title>

    <script src="/js/jquery-3.2.1.min.js"></script>
    
    <link href="/css/google-font-Roboto.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/nahtube.css">

    <style>
    /* Optional: Makes the sample page fill the window. */
    html,
    body {
        height: 100%;
        margin: 200;
        padding: 0;
    }

    div.video-thumbnail, div.video-content {
	    font-family: 'Roboto', sans-serif;
        margin: 10px;
        float: left;
    }

    h3.video-title {
        line-height: 2px;
    }

    div.video-meta {
        font-family: 'Roboto', sans-serif;
        font-size: 12px;
        color: #9f9f9f;
    }

    div.related-video-container {
        overflow: hidden;
    }

    #player {
        z-index: 2;
        margin-left: 20px;
        margin-right: 10px;
        margin-top: 3px;
    }

    #channel-title {
        margin-left: 50px;
    }

    .channel-title {
        font-size: 20px;
    }

    #related-videos-list {
        z-index: 1;
        float: right;
    }

    </style>    
    <script>
        function assembleQueryString(videoId, channelId) {
            var qstr = '?v=' + videoId;

            qstr += (channelId ? '&c=' + channelId : '' );

            return qstr;
        }
        function getRelatedVideos(videoId) {
            $("#related-videos-list").empty();

            // AJAX call to populate the Allowed Channels div above
            $.get( "/youtube/related/" + videoId, function( data ) {
                $( ".result" ).html( data );
                $.each(data.items, function(index, entry) {

                    var video_row = 
                        '<div class="related-video-container">' +
                        '  <a href="/youtube/watch' + assembleQueryString(entry.id.videoId, entry.snippet.channelId) + '">' +
                        '    <div class="video-thumbnail"><img src="' + entry.snippet.thumbnails.default.url + '"></div>\n' +
                        '  </a>\n' +
                        '  <div class="video-content">' + 
                        '    <h3 class="video-title">' + 
                        '      <a href="/youtube/watch' + assembleQueryString(entry.id.videoId, entry.snippet.channelId) + '">' + entry.snippet.title + '</a>\n' +
                        '    </h3>\n' + 
                        '    <div class="video-meta">' + entry.snippet.channelTitle + '</div>\n' +
                        '  </div>' +
                        '</div>';

                    var tabular_video_row = 
                        '<div class="related-video-container" class="row">' +
                        '   <table border=0><tr><td>' +
                        '       <a href="/youtube/watch' + assembleQueryString(entry.id.videoId, entry.snippet.channelId) + '">' +
                        '           <div class="video-thumbnail" class="col"><img src="' + entry.snippet.thumbnails.default.url + '"></div>\n' +
                        '       </a>\n' +
                        '   </td><td width="100%">' +
                        '       <div class="video-content col">' + 
                        '           <h3 class="video-title">' + 
                        '               <a href="/youtube/watch' + assembleQueryString(entry.id.videoId, entry.snippet.channelId) + '">' + entry.snippet.title + '</a>\n' +
                        '           </h3>\n' + 
                        '           <div class="video-meta">' + entry.snippet.channelTitle + '</div>\n' +
                        '       </div>' +
                        '   </td></tr></table>' +
                        '</div>';

                    $("#related-videos-list").append(tabular_video_row);
                });
            });
        }
    </script>
</head>

<body>

    <% include topbar.ejs %>

    <div class="row">

        <div>
            <div id="player" class="col-8">
                <iframe id="ytplayer" type="text/html" width="854" height="480"
                src="https://www.youtube.com/embed/<%= videoId %>?autoplay=1&rel=0"
                frameborder="0"
                allowfullscreen="allowfullscreen"
                mozallowfullscreen="mozallowfullscreen" 
                msallowfullscreen="msallowfullscreen" 
                oallowfullscreen="oallowfullscreen" 
                webkitallowfullscreen="webkitallowfullscreen"></iframe>
            </div>

            <% if (locals.channelTitle) { %>
                <div id="channel-title"><a class="channel-title" href="/youtube/videos/<%= channelId %>"><%= channelTitle %></a></div>
            <% } %>
            
        </div>


        <div id="related-videos-list" class="col">
        </div>

    </div>

    <script>
        getRelatedVideos( '<%= videoId %>' ); // this looks pretty bad to me...
    </script>

</body>

</html>