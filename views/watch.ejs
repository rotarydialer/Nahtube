<!DOCTYPE html>
<html>

<head>
    <title><%= title %> - Watch</title>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/nahtube.css">

    <style>
    /* Optional: Makes the sample page fill the window. */
    html,
    body {
        height: 100%;
        margin: 200;
        padding: 0;
    }

    div.video-thumbnail, div.video-content {
	    font-family: 'Roboto', sans-serif;
        margin: 10px;
        float: left;
    }

    div.video-container {
        overflow: hidden;
    }
    </style>    
    <script>
        function assembleQueryString(videoId, channelId) {
            var qstr = '?v=' + videoId;

            qstr += (channelId ? '&c=' + channelId : '' );

            return qstr;
        }
        function getRelatedVideos(videoId) {
            $("#related-videos-list").empty();

            // AJAX call to populate the Allowed Channels div above
            $.get( "/youtube/related/" + videoId, function( data ) {
                $( ".result" ).html( data );
                $.each(data.items, function(index, entry) {
                    console.log('in here...');

                    var video_row = 
                        '<div class="video-container">' +
                        '  <a href="../watch' + assembleQueryString(entry.id.videoId, entry.snippet.channelId) + '">' +
                        '    <div class="video-thumbnail"><img src="' + entry.snippet.thumbnails.default.url + '"></div>\n' +
                        '  </a>\n' +
                        '  <div class="video-content">' + 
                        '    <h3 class="video-title">' + 
                        '      <a href="/youtube/watch' + assembleQueryString(entry.id.videoId, entry.snippet.channelId) + '">' + entry.snippet.title + '</a>\n' +
                        '    </h3>\n' + 
                        '    <div class="video-meta">' + entry.snippet.channelTitle + '</div>\n' +
                        '  </div>' +
                        '</div>';

                    $("#related-videos-list").append(video_row);
                });
            });
        }
    </script>
</head>

<body>

    <% include topbar.ejs %>
    
    <div id="player">
        <iframe id="ytplayer" type="text/html" width="854" height="480"
        src="https://www.youtube.com/embed/<%= videoId %>?autoplay=1"
        frameborder="0"
        allowfullscreen="allowfullscreen"
        mozallowfullscreen="mozallowfullscreen" 
        msallowfullscreen="msallowfullscreen" 
        oallowfullscreen="oallowfullscreen" 
        webkitallowfullscreen="webkitallowfullscreen"></iframe>
    </div>


    <div id="related-videos-list">
    </div>

    <script>
        getRelatedVideos( '<%= videoId %>' ); // this looks pretty bad to me...
    </script>

</body>

</html>