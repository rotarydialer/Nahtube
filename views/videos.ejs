<!DOCTYPE html>
<html>

<head>
    <title>Videos</title>

    <script src="/js/jquery-3.2.1.min.js"></script>
    
    <link href="/css/google-font-Roboto.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/nahtube.css">

    <style>
    /* Optional: Makes the sample page fill the window. */
    html,
    body {
        height: 100%;
        margin: 200;
        padding: 0;
    }

    div.video-thumbnail {
	    font-family: 'Roboto', sans-serif;
        margin: 10px;
        float: left;
    }

    div.video-container {
        /* border-style: solid;
        border-width: 1px; */
        overflow: hidden;
    }

    div.video-content {
	    font-family: 'Roboto', sans-serif;
        margin-left: 10px;
        margin-top: 15px;
        float: left;
        word-wrap: break-word;
    }

    .video-link {
        font-size: 14px;
        color: #007bff;
    }

    .video-link:hover {
        text-decoration: underline;
    }

    div.video-meta {
        font-family: 'Roboto', sans-serif;
        font-size: 12px;
        color: #9f9f9f;
    }

    </style>
    <script>
        function assembleQueryString(videoId, channelId) {
            var qstr = '?v=' + videoId;

            qstr += (channelId ? '&c=' + channelId : '' );

            return qstr;
        }

        function getVideosForChannelId(channelId) {
            $.ajax({
                type: "GET",
                url: "/youtube/videos/" + channelId + ".json",
                data: {"channelId": this.value},
                success: function (data) {
                    $('#channelTitle').text('Videos for ' + data.channelTitle);

                    $('#videos-list').empty();

                    $.each(data.items, function (i, item) {

                        var videoId = item.snippet.resourceId.videoId;

                        // $('#videos-list').append(
                        //     '<div class="video-container">' +
                        //     '  <input id="videoDetailsFull" type="hidden" value="' + JSON.stringify(item) + '">' +
                        //     '  <a href="../watch' + assembleQueryString(videoId, channelId) + '">' +
                        //     '    <div class="video-thumbnail"><img src="' + item.snippet.thumbnails.medium.url + '"></div>\n' +
                        //     '  </a>\n' +
                        //     '  <div class="video-content">' + 
                        //     '    <h3 class="video-title">' + 
                        //     '      <a href="../watch' + assembleQueryString(videoId, channelId) + '">' + item.snippet.title + '</a>\n' +
                        //     '    </h3>\n' + 
                        //     '    <div class="video-meta">' + data.channelTitle + '</div>\n' +
                        //     '  </div>' +
                        //     '</div>'
                        // );

                        // open watch links via POST
                        $('#videos-list').append(
                            '<form id= "' + videoId + '" method="POST" action="/youtube/watch' + assembleQueryString(videoId, channelId) + '">' +
                            '<div class="video-container">' +
                            '  <input name="videoDetailsFull" class="video-url" type="hidden" value=\'' + JSON.stringify(item) + '\'>' +
                            '  <div class="video-link" onClick=$("#' + videoId + '").submit()>' +
                            '    <div class="video-thumbnail"><img src="' + item.snippet.thumbnails.medium.url + '"></div>\n' +
                            '  </div>\n' +
                            '  <div class="video-content">' + 
                            '    <div class="video-title">' + 
                            '      <div class="video-link" onClick=$("#' + videoId + '").submit()>' + item.snippet.title + '</div>\n' +
                            '    </div>\n' + 
                            '    <div class="video-meta">' + data.channelTitle + '</div>\n' +
                            '  </div>' +
                            '</div>' +
                            '</form>'
                        );
                    });

                    // the jQuery definition determines these, and the params of the callback
                    // http://api.jquery.com/jquery.each/
                    //$.each(data.items, constructVideoResult);
                }
            });

        }
        </script>
</head>

<body>
    <% include topbar.ejs %>
    <!-- <h1><span id="channelTitle"></span></h1> -->

    <div id="videos-list">
    </div>

    <script>
        getVideosForChannelId( '<%= channelId %>' ); // this looks pretty bad to me...
    </script>

</body>

</html>